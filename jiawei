import os
import sys

from serial.serialutil import SerialBase
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '../../../')))

import asyncio
from sphero_sdk import SpheroRvrAsync
from sphero_sdk import SerialAsyncDal
from sphero_sdk import RvrStreamingServices
from sphero_sdk import RvrLedGroups
from sphero_sdk import Colors


loop = asyncio.get_event_loop()

rvr = SpheroRvrAsync(
    dal=SerialAsyncDal(
        loop
    )
)


async def ambient_light_handler(ambient_light_data):
    for Light in ambient_light_data:
        checkvalid = bool(ambient_light_data[Light]['is_valid'])
        lightdata = int(ambient_light_data[Light]['Light'])
    lbv= -0.256*lightdata+256
    led_group=RvrLedGroups.all_lights.value   
    led_brightness_values=[lbv, lbv, lbv]

async def main():
    """ This program demonstrates how to enable a single sensor to stream.
    """

    await rvr.wake()

    # Give RVR time to wake up
    await asyncio.sleep(2)

    await rvr.sensor_control.add_sensor_data_handler(
        service=RvrStreamingServices.ambient_light,
        handler=ambient_light_handler
    )

    await rvr.sensor_control.start(interval=250)
